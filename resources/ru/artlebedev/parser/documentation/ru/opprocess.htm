<html>
<head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=windows-1251">
    <meta name="keywords" content="process,include">
    <title>process. Компиляция и исполнение строки</title>

    <script language="JavaScript"><!--
    if(top.frames.length==0) {
        top.location.href='./?opprocess.htm'
    } else {
        if(document.referrer!='' && 0>document.referrer.indexOf(top.frames[0].location.pathname)) {
            top.frames[0].location.hash='opprocess.htm'
        }
    }
    //--></script>

</head>

<body bgcolor="#FFFFFF" text="black">


<table border="0" cellspacing="0" cellpadding="2">
  <tr>
    <td>
      
<span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>process. Компиляция и исполнение строки
<br>
</b></span>
    </td>
  </tr>
  <tr><td bgcolor="#99D228" height="3"></td></tr>
</table>
<br>



<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^process{строка}
<br>
^process[контекст]{строка}
<br>
^process[контекст]{строка}[опции]&nbsp;&nbsp;&nbsp;</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b><i>[3.1.2]</i></b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Строка</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет скомпилирована и выполнена как код на Parser, в указанном </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>контексте</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, или в текущем контексте.
<br>
В качестве </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>контекста</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> можно указать <a href=obj.htm>объект</a> или <a href=defineclass.htm>класс</a>, но </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>не&nbsp;метод</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> (т.е. если вы внутри вашего метода вызовите process, то внутри выполняемого с помощью process кода не будут доступны локальные переменные вызывающего метода).
<br>

<br>
Удобно использовать, если какие-то части кода  или собственные методы необходимо хранить не в файлах </span><span style="font-family:Monospace; font-size:10pt; color:#000000">.html</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, которые обрабатываются Parser, а в каких-то других, или базе данных.
<br>

<br>
Также можно указать ряд </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>опций</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> (<a href=hash.htm>хеш</a>):
<br>
<table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b></b><font face="Symbol" size="2" color="#000000">&#183;</font><b></b></span></td><td><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.main[</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">новое имя для метода </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>main</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, описанного в коде </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>строки]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b></b><font face="Symbol" size="2" color="#000000">&#183;</font><b></b></span></td><td><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.file[</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">имя файла, из которого взята данная </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>строка]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b></b><font face="Symbol" size="2" color="#000000">&#183;</font><b></b></span></td><td><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$.lineno(</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">номер строки в файле, откуда взята данная </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>строка.</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i> может быть отрицательным</i></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>)</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"></span></td><td></td></tr></table><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Простые примеры
<br>
</b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>^process{</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@extra[]
<br>
&nbsp;&nbsp;&nbsp;Здоровья&nbsp;прежде&nbsp;всего…
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Метод </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>extra</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет добавлен к текущему классу, и его можно будет вызывать в дальнейшем.
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>^process[$engine:</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=defineclass.htm>CLASS</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]{</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@start[]
<br>
&nbsp;&nbsp;&nbsp;Мотор…
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Метод </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>start</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет добавлен к пользовательскому классу </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>engine</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$running_man[^man</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=obj.htm>::</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>create[Вася]]
<br>
^process[$running_man]{
<br>
&nbsp;&nbsp;&nbsp;&nbsp;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Имя:&nbsp;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$name</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;br&nbsp;/&gt;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Код будет выполнен в контексте объекта </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$running_man</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, соответственно, может воспользоваться полем </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>name</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> этого объекта, выдаст «</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Вася</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">».
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Оператор include
<br>
</b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@include[filename][file]
<br>
$file[^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=fileload.htm>file::load</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[text;$filename]]
<br>
^process[$</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=definemethod.htm>caller.self</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]{^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=opuntainttaint.htm>taint</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[as-is][$file.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=filefields.htm>text</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]}[
<br>
&nbsp;&nbsp;&nbsp;$.file[$filename]
<br>
]
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Код загружает указанный файл и выполняет его в контексте объекта/класса, вызвавшего </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>include</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Опция </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>file</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> позволяет указать имя файла, откуда был загружен код. Если возникнет ошибка, вы увидите это «имя файла».
<br>
<i>Важно: контекст вызова не включает локальные переменные и параметры вызывающего метода!</i>
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Сложный пример</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Часто удобно поместить компилируемый код в некоторый метод с именем, вычисляющимся по ходу работы:
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>#&nbsp;это&nbsp;исходный&nbsp;код,&nbsp;обратите&nbsp;внимание,&nbsp;на&nbsp;^^
<br>
$source_code[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>2*2=</b><b><a href=stringlit.htm>^^</a></b><b>eval(2*2)</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>
#&nbsp;по&nbsp;ходу&nbsp;работы&nbsp;выясняется,&nbsp;что&nbsp;необходимо&nbsp;создать&nbsp;метод&nbsp;с&nbsp;именем&nbsp;method1
<br>
$method_name[method1]
<br>
#&nbsp;компилируем&nbsp;исходный&nbsp;код,&nbsp;помещяем&nbsp;его&nbsp;в&nbsp;новый&nbsp;метод
<br>
^process{$source_code}[
<br>
&nbsp;&nbsp;&nbsp;$.main[$method_name]
<br>
]
<br>
…
<br>
#&nbsp;далее&nbsp;по&nbsp;коду&nbsp;можно&nbsp;вызывать&nbsp;метод&nbsp;method1
<br>
^method1[]
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Данный пример будет продолжать работать, даже если в </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$source_code</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет определен ряд методов, поскольку </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>опция&nbsp;main</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> задает новое имя методу </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>main</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
</b></span></span></span><br>

<!--#include virtual="/docs/comment.html" -->


<hr size=1>
<table border="0" cellspacing="0" cellpadding="0" width="100%">
<tr valign="top">
<td><font size="1">Copyright &copy; 1997&#150;2011 Art. Lebedev Studio | <a href="http://www.artlebedev.ru/" target="_blank">http://www.artlebedev.ru</a></font></td>
<td align="right"><font size="1">Дата обновления: 21.09.2007</font></td>
</tr>
</table>
</body>
</html>
