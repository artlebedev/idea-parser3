<html>
<head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=windows-1251">
    <meta name="keywords" content="CLASS,include *,main,result,operator *,self,caller,caller.self">
    <title>Определяемые пользователем методы и операторы</title>

    <script language="JavaScript"><!--
    if(top.frames.length==0) {
        top.location.href='./?definemethod.htm'
    } else {
        if(document.referrer!='' && 0>document.referrer.indexOf(top.frames[0].location.pathname)) {
            top.frames[0].location.hash='definemethod.htm'
        }
    }
    //--></script>

</head>

<body bgcolor="#FFFFFF" text="black">


<table border="0" cellspacing="0" cellpadding="2">
  <tr>
    <td>
      
<span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Определяемые пользователем методы и операторы
<br>
</b></span>
    </td>
  </tr>
  <tr><td bgcolor="#99D228" height="3"></td></tr>
</table>
<br>



<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@имя[параметры]
<br>
</b><b>тело</b><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
@имя[параметры][локальные;переменные]</b></span><span style="font-family:Times New Roman; font-size:12pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>тело</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
@</b><b>static:</b><b>имя[параметры]</b></span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b><i>[3.</i></b><b><i>4</i></b><b><i>.</i></b><b><i>1</i></b><b><i>]</i></b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b><b>тело&nbsp;метода&nbsp;класса,&nbsp;который&nbsp;может&nbsp;быть&nbsp;вызван&nbsp;только&nbsp;статически&nbsp;(</b><b><a href=defineclass.htm>подробности</a></b><b>)</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
@имя[*параметры]</b></span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b><i>[3.</i></b><b><i>4</i></b><b><i>.</i></b><b><i>1</i></b><b><i>]</i></b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b><b>тело</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
@имя[параметр1</b><b>;</b><b>параметр2</b><b>;</b><b>*параметры]</b></span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b><i>[3.</i></b><b><i>4</i></b><b><i>.</i></b><b><i>1</i></b><b><i>]</i></b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b><b>тело</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Метод, это блок кода, имеющий имя, принимающий параметры, и возвращающий результат. Имена параметров метода перечисляются через точку с запятой. Метод также может иметь локальные переменные, которые необходимо объявить в заголовке метода, после объявления параметров, имена разделяются точкой с запятой.
<br>

<br>
Локальные переменные видны в пределах оператора или метода, и изнутри вызываемых ими операторов и методов, см. ниже </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$caller</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>

<br>
При описании метода можно пользоваться не только параметрами или локальными переменными, а также любыми другими именами, при этом вы будете работать с полями класса, или полями объекта, в зависимости от того, как был вызван определенный вами метод, <a href=stats.htm>статически</a>, или <a href=obj.htm>динамически</a>.
<br>

<br>
В Parser вы можете <a href=opuserdefined.htm>расширить</a> базовый набор операторов, операторами в Parser считаются методы класса <a href=mainclass.htm>MAIN</a>.<i>
<br>
Важно: операторы, это методы класса </i><i><a href=mainclass.htm>MAIN</a></i><i>, но в отличие от методов других классов, их можно вызвать из любого класса просто по имени, т.е. можно писать </i></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^include[…]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>, вместо громоздкого </i></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^MAIN:include[…]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>.
<br>
</i><i>
<br>
</i></span><span style="font-family:Arial; font-size:10pt; color:#000000">В методах, которые могут принимать произвольное число параметров все «лишние параметры» доступны в виде хеша с числовыми ключами.
<br>
</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b>
<br>
Пример:
<br>
</b></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@main[]
<br>
^call[a;b;c]
<br>

<br>
@call[p;*args][k;v]
<br>
p=$p
<br>
^args.foreach[k;v]{
<br>
&nbsp;&nbsp;&nbsp;$k=$v
<br>
}[^#0A]</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>
<br>
</i><i>
<br>
</i>Выведет:
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>p=a
<br>
0=b
<br>
1=c</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>
<br>

<br>
</i><i>
<br>
</i></span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Системная переменная: self
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Все методы и операторы имеют локальную переменную </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>self</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, она хранит ссылку на текущий объект, в статических методах хранит  то же, что и </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$CLASS</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>

<br>
<b>Пример: </b></span><span style="font-family:Times New Roman; font-size:12pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@main[]&nbsp;&nbsp;
<br>
$a[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Статическое&nbsp;поле&nbsp;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>^$a</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;класса&nbsp;MAIN</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>
^test[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Параметр&nbsp;метода</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>

<br>
@test[a]&nbsp;&nbsp;
<br>
^$a</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;-&nbsp;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$a</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&nbsp;
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>^$self.a</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;-&nbsp;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$self.a&nbsp;&nbsp;
<br>
</b></span></span><span style="font-family:Times New Roman; font-size:12pt; color:#000000">&nbsp;&nbsp;&nbsp;
<br>
</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Выведет:   
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$a&nbsp;-&nbsp;Параметр&nbsp;метода&nbsp;&nbsp;
<br>
$self.a&nbsp;-&nbsp;Статическое&nbsp;поле&nbsp;$a&nbsp;класса&nbsp;MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">  
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Системная переменная: result
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Все методы и операторы имеют локальную переменную </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>result</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Если ей присвоить какое-то значение, то именно оно будет результатом выполнения метода. Значение переменной </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>result</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> можно считывать и использовать в вычислениях. 
<br>

<br>
<b>Пример:</b>
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=mainclass.htm>main</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[]
<br>
$a(2)
<br>
$b(3)
<br>
$summa[^sum[$a;$b]]
<br>
$summa
<br>

<br>
@sum[a;b]
<br>
^eval($a+$b)
<br>
$result[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Ничего&nbsp;не&nbsp;скажу!</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Здесь клиенту будет выдана строка </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Ничего&nbsp;не&nbsp;скажу!</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, а не результат сложения двух чисел.
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Системная переменная: result</b><b>, </b><b>явное определение&nbsp;&nbsp;&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b><i>[3.1.5]</i></b></span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Если в методе явно объявить локальную переменную </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>result</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, это укажет Parser, что нужно проигнорировать все пробельные символы и считать ошибочными любые не пробельные символы, если их явно не присваивают переменной </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>result</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>

<br>
<b>Пример:</b>
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@lookup[table;findcol;resultcol;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>findvalue;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>notfound]</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[result]</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
^if</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>(^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tableclass.htm>table</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablelocate.htm>locate</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[$</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>findcol</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>;$findvalue]){
<br>
&nbsp;&nbsp;&nbsp;$table.$</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>resultcol</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
}{
<br>
&nbsp;&nbsp;&nbsp;$</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>notfound</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Здесь клиенту будет выдано либо значение из колонки </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$resultcol</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, либо значение </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$notfound</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>
Важно: в приведенном примере <b>не будет</b> выдано ни одного символа перевода строки, пробела или табуляции. 
<br>
Важно: попытка заменить $notfound текстом, написанным прямо в теле метода, приведен к ошибке. Чтобы Parser не воспринимал написанные в теле метода не пробельные символы как ошибку их нужно явно присваивать переменной result.
<br>

<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Системная переменная: caller
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Все методы и операторы имеют локальную переменную </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>caller</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, которая хранит «контекст вызова» метода или оператора.
<br>

<br>
Через нее можно:
<br>
<table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><font face="Symbol" size="2" color="#000000">&#183;</font></span></span></td><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">узнать, кто вызвал вызвавший описываемый метод или оператор, обратившись к </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$caller.self</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">;</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
&nbsp;<br>
</b></span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:Monospace; font-size:10pt; color:#000000"><b></b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><font face="Symbol" size="2" color="#000000">&#183;</font></span></td><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">считать - </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$caller.считать</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, или записать - </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$caller.записать[значение]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> переменную, как будто вы находитесь в том месте, откуда вызвали описываемый метод или оператор.
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"></span></td><td></td></tr></table><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Например вам нужен оператор, похожий на системный </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b><a href=opfor.htm>for</a></b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, но чем-то отличающийся от него. Вы можете написать его сами, воспользовавшись возможностью менять локальную переменную с именем, переданным вам, в </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>контексте&nbsp;вызова&nbsp;вашего&nbsp;оператора</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@steppedfor[name;from;to;step;code]
<br>
$caller.$name($from)
<br>
^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=opwhile.htm>while</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>($caller.$name&lt;=$to){
<br>
&nbsp;&nbsp;&nbsp;$code
<br>
&nbsp;&nbsp;&nbsp;^caller.$name.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=intdoubleincetc.htm>inc</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>($step)
<br>
}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Теперь такой вызов…
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@somewhere[][i]
<br>
^steppedfor[i](1;10;2){$i&nbsp;}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
…напечатает «</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>1&nbsp;3&nbsp;5&nbsp;7&nbsp;9&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">», обратите внимание, что изменяется </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>локальная&nbsp;переменная&nbsp;метода&nbsp;somewhere.</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>Примечание: возможность узнать контекст вызова удобна для задания контекста компиляции кода (см. «</i><i><a href=opprocess.htm>process. Компиляция и исполнение строки</a></i><i>».
<br>

<br>

<br>
</i></span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Системная переменная: locals</b><b>, </b><b>явное определение&nbsp;&nbsp;&nbsp;</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><b><i>[3.3.0]
<br>
</i></b></span><span style="font-family:Arial; font-size:10pt; color:#000000">Если в методе явно объявить локальную переменную </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>locals</b></span><span style="font-family:Arial; font-size:10pt; color:#000000">, </span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">это будет равносильно объявлению всех переменных, используемых в нем локальными.
<br>
Для обращения к переменных класса или объекта в этом случае необходимо использовать </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>self</b></span><span style="font-family:Arial; font-size:10pt; color:#000000">.
<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b><i>
<br>
</i></b></span></span><br>

<!--#include virtual="/docs/comment.html" -->


<hr size=1>
<table border="0" cellspacing="0" cellpadding="0" width="100%">
<tr valign="top">
<td><font size="1">Copyright &copy; 1997&#150;2011 Art. Lebedev Studio | <a href="http://www.artlebedev.ru/" target="_blank">http://www.artlebedev.ru</a></font></td>
<td align="right"><font size="1">Дата обновления: 22.02.2011</font></td>
</tr>
</table>
</body>
</html>
