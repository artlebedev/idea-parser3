<html>
<head>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=windows-1251">
    <meta name="keywords" content="MAIN,auto.p">
    <title>Урок 5. Пользовательские классы Parser</title>

    <script language="JavaScript"><!--
    if(top.frames.length==0) {
        top.location.href='./?lesson5.htm'
    } else {
        if(document.referrer!='' && 0>document.referrer.indexOf(top.frames[0].location.pathname)) {
            top.frames[0].location.hash='lesson5.htm'
        }
    }
    //--></script>

</head>

<body bgcolor="#FFFFFF" text="black">


<table border="0" cellspacing="0" cellpadding="2">
  <tr>
    <td>
      
<span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Урок 5. Пользовательские классы Parser
<br>
</b></span>
    </td>
  </tr>
  <tr><td bgcolor="#99D228" height="3"></td></tr>
</table>
<br>



<span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">Во всех предыдущих уроках мы оперировали классами и объектами, предопределенными в Parser. Например, есть уже хорошо знакомый нам класс table, у него существуют свои методы, которые мы широко использовали. Полный список всех методов этого класса можно посмотреть в <a href=tableclass.htm>справочнике</a>. Однако ограничение разработчиков рамками только базовых классов в какой-то момент может стать сдерживающим фактором. «Неспособность не есть благодетель, а есть бессилие…», поэтому для удовлетворения всех потребностей пользователей необходимо иметь возможность создавать собственные (пользовательские) классы объектов со своими методами. На этом уроке мы и создадим средствами Parser новый класс объектов со своими собственными методами. 
<br>

<br>
Объектом, в принципе, может быть все что угодно: форум, гостевая книга, различные разделы и даже целый сайт. Здесь мы подошли к очередному уровню структуризации - на уровне объектов, а не методов. Как мы поступали раньше? Мы выделяли отдельные куски кода в методы и вызывали их, когда они были необходимы. Но в качестве отдельных блоков сайта было бы намного удобнее использовать собственные объекты: для получения форума создаем объект класса «форум», после чего используем его методы, например «удалить сообщение», «показать все сообщения» и поля, например, «количество сообщений». При этом обеспечивается модульный подход на качественно ином уровне, чем простое использование функций. В единую сущность собираются код и данные (методы и поля). Разрозненные ранее методы и переменные объединяются воедино и используются применительно к конкретному объекту - «форуму». В терминах объектно-ориентированного программирования это называется инкапсуляцией.  Кроме того, один раз создав класс форум, его объекты можно использовать в различных проектах, абсолютно ничего не меняя.
<br>

<br>
Работу с пользовательским классом мы покажем на примере гостевой книги, а для начала еще раз напомним порядок работы с объектами в Parser. Сначала необходимо создать объект определенного класса с помощью конструктора, после чего можно вызывать методы объектов этого класса и использовать поля созданного объекта. В случае пользовательского класса ничего не меняется, порядок тот же.
<br>

<br>
Как всегда начнем с определения того, что нам нужно сделать. Правильная постановка задачи - уже половина успеха. Перед началом создания класса нужно точно определить, что будет делать объект класса, то есть решить, какие у него будут методы. Предположим, что нашими методами будут: показ сообщений гостевой книги, показ формы для добавления записи, а также метод, добавляющий сообщение в гостевую книгу. Хранить сообщения будем в базе данных, так же как и новости. 
<br>

<br>
Если с методами класса все более или менее ясно, то некоторая неясность остается с конструктором класса, что же он будет делать? Опираясь на прошлые уроки, мы помним, что для того, чтобы начать работать с объектом класса, его необходимо создать, или проинициализировать. Давайте с помощью конструктора будем получать таблицу с сообщениями, а затем в методе показа сообщений будем пользоваться данными этой таблицы. 
<br>

<br>
С целями определились, займемся реализацией. Прежде всего, создадим таблицу <span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> в базе данных </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>p3test</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">:</span><span style="font-family:Monospace; font-size:10pt; color:#000000">
<br>
<b>
<br>
<table border="1" cellpadding="1"><tr><td align="left" valign="top" width="95">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>id</b>
<br>
</span></td><td align="left" valign="top" width="415">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>int not null auto_increment primary key</b>
<br>
</span></td></tr><tr><td align="left" valign="top" width="95">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>author</b>
<br>
</span></td><td align="left" valign="top" width="415">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>varchar(255)</b>
<br>
</span></td></tr><tr><td align="left" valign="top" width="95">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>email</b>
<br>
</span></td><td align="left" valign="top" width="415">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>varchar(255)</b>
<br>
</span></td></tr><tr><td align="left" valign="top" width="95">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>date</b>
<br>
</span></td><td align="left" valign="top" width="415">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>date</b>
<br>
</span></td></tr><tr><td align="left" valign="top" width="95">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>body</b>
<br>
</span></td><td align="left" valign="top" width="415">
<span style="font-family:Monospace; font-size:10pt; color:#000000"><b>t</b><b>ext</b>
<br>
</span></td></tr></table>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Теперь необходимо познакомиться еще с несколькими понятиями Parser  - классом </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b><a href=mainclass.htm>MAIN</a></b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> и наследованием. Как уже говорилось, класс является объединяющим понятием для объектов, их методов и полей. Класс </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> объединяет в себя методы и переменные, описанные пользователями в файлах </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>auto.p</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> и запрашиваемом документе (например, </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>index.html</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">). Каждый следующий уровень вложенности наследует методы, описанные в </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>auto.p</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> предыдущих уровней каталога. Эти методы, а также методы, описанные в запрашиваемом документе, становятся статическими функциями класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, а все переменные, созданные в </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>auto.p</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> вверх по каталогам и в коде запрошенной страницы, - статическими полями класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. 
<br>

<br>
Для пояснения рассмотрим следующую структуру каталогов:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000">&nbsp;&nbsp;&nbsp;/
<br>
&nbsp;&nbsp;&nbsp;|__&nbsp;auto.p
<br>
&nbsp;&nbsp;&nbsp;|__&nbsp;news/
<br>
&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;|___auto.p
<br>
&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;|___index.html
<br>
&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;|___details/
<br>
&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_______&nbsp;auto.p
<br>
&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_______index.html
<br>
&nbsp;&nbsp;&nbsp;|__contacts/&nbsp;|
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_______auto.p
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|_______index.html
<br>
</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
&nbsp;&nbsp;&nbsp;  
<br>

<br>
При загрузке страницы </span><span style="font-family:Monospace; font-size:10pt; color:#000000">index.html</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> из каталога </span><span style="font-family:Monospace; font-size:10pt; color:#000000">/news/details/</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> класс </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет динамически «собран» из методов, описанных в корневом файле </span><span style="font-family:Monospace; font-size:10pt; color:#000000">auto.p</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, а также в файлах </span><span style="font-family:Monospace; font-size:10pt; color:#000000">auto.p</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> разделов </span><span style="font-family:Monospace; font-size:10pt; color:#000000">/news/</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> и </span><span style="font-family:Monospace; font-size:10pt; color:#000000">/news/details/</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Методы, описанные в </span><span style="font-family:Monospace; font-size:10pt; color:#000000">auto.p</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> раздела </span><span style="font-family:Monospace; font-size:10pt; color:#000000">/contacts/</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, будут недоступны для страниц из раздела </span><span style="font-family:Monospace; font-size:10pt; color:#000000">/news/details/</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.
<br>

<br>
Как «собирается» класс </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> теперь понятно, но, прежде чем приступить к созданию собственного класса, необходимо также выяснить, как из <i>пользовательского</i> класса вызывать методы и получать значения переменных класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Методы класса  </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> вызываются как статические функции:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^MAIN:метод[]</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">,</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
а переменные являются статическими полями класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. К ним можно получить доступ так же, как к любым другим статическим полям:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>$MAIN:поле
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Теперь переходим к практике. В корневой </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>auto.p</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> добавляем еще один метод, с помощью которого можно будет не только соединяться с БД, но и передавать ей произвольный SQL-запрос:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@dbconnect[code]
<br>
^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=opconnect.htm>connect</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[$connect_string]{$code}
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>#&nbsp;connect_string&nbsp;определяется&nbsp;в&nbsp;методе&nbsp;@auto[]
<br>
#&nbsp;$connect_string[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=app3mysql.htm>mysql://root@localhost/p3test</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Метод вынесен в корневой </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>auto.p</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> для того, чтобы впоследствии можно было бы легко подключаться к серверу баз данных с любой страницы, поскольку методы из корневого </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>auto.p</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будут наследоваться всегда. Обратите внимание на то, что здесь используется передача методу параметра. В нашем случае он один - </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>code</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, с его помощью мы и будем передавать код, выполняющий SQL-запросы. Параметров может быть и несколько, в этом случае они указываются через точку с запятой.
<br>

<br>
Дальше в каталоге нашего сайта создаем подкаталог, в которой будем хранить файл с нашим классом, например, </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>classes</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Далее в этом каталоге создаем файл </span><span style="font-family:Monospace; font-size:10pt; color:#000000">gbook.p</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> (пользовательские файлы мы предлагаем хранить в файлах с расширением имени </span><span style="font-family:Monospace; font-size:10pt; color:#000000">.p</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">) и в него заносим следующий код:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=defineclass.htm>@CLASS</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
gbook
<br>

<br>
@load[]
<br>
^MAIN:dbconnect{
<br>
&nbsp;&nbsp;&nbsp;$messages[^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tableclass.htm>table</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>::</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablesql.htm>sql</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>{</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>select&nbsp;author,&nbsp;email,&nbsp;date,&nbsp;body&nbsp;from&nbsp;gbook</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}]
<br>
}
<br>

<br>
@show_messages[]
<br>
^if($messages){
<br>
&nbsp;&nbsp;&nbsp;^messages.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablemenu.htm>menu</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>{
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&nbsp;width="100%"&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;
<br>
</b><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;align=</b><b>"left"</b><b>&gt;&lt;b&gt;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$messages.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablefields.htm>author</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^if(def&nbsp;$messages.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablefields.htm>email</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>){
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$messages.email
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}{
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Нет&nbsp;электронного&nbsp;адреса
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;/b&gt;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;/td&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;align=</b><b>"right"</b><b>&gt;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$messages.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablefields.htm>date</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;/td&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&nbsp;width="100%"&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$messages.</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=tablefields.htm>body</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;/td&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;
<br>
&nbsp;&nbsp;&nbsp;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}[</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;table&nbsp;wi</b><b>dth="100%"&nbsp;border="0"&nbsp;bgcolor="000000"&nbsp;cellspacing="0"&gt;&nbsp;
<br>
</b><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;&lt;td&gt;&amp;nbsp^;&lt;/td&gt;&lt;/tr&gt;
<br>
&nbsp;&nbsp;&nbsp;&lt;/table&gt;</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}{
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;Гостевая&nbsp;книга&nbsp;пуста.
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}
<br>

<br>
@show_form[]
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;hr&nbsp;/&gt;
<br>
&lt;br&nbsp;/&gt;
<br>

<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>$date[^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=datenow.htm>date::now</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[]]
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&lt;center&gt;
<br>
&lt;form&nbsp;method=</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>"POST"</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&gt;
<br>
&lt;p&gt;
<br>
Author&lt;sup&gt;*&lt;/sup&gt;&lt;input&nbsp;name="author"</b><b>&nbsp;/</b><b>&gt;&lt;br&nbsp;/&gt;
<br>
E-mail&amp;nbsp;&amp;nbsp;&lt;input&nbsp;name="email"</b><b>&nbsp;/</b><b>&gt;&lt;br&nbsp;/&gt;</b><b>
<br>
T</b><b>ext&lt;br&nbsp;/&gt;&lt;textarea&nbsp;cols=</b><b>"50"&nbsp;name="text"&nbsp;rows="5"&gt;</b><b>&lt;/textarea&gt;
<br>
&lt;/p&gt;
<br>
&lt;p&gt;
<br>
&lt;input&nbsp;type=</b><b>"submit"&nbsp;value</b><b>="Send"&nbsp;name="post"</b><b>&nbsp;/</b><b>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;
<br>
&lt;input&nbsp;type=</b><b>"reset"&nbsp;value=</b><b>"Cancel"</b><b>&nbsp;/</b><b>&gt;
<br>
&lt;/p&gt;
<br>
&lt;/form&gt;
<br>
&lt;/center&gt;
<br>

<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@test_and_post_message[]
<br>
^if(</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=opdef.htm>def</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>&nbsp;$form:post){
<br>
&nbsp;&nbsp;&nbsp;^if(def&nbsp;$form:author){
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^MAIN:dbconnect{
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=voidsql.htm>void:sql</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>{</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>insert&nbsp;into&nbsp;gbook
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(author,&nbsp;email,&nbsp;date,&nbsp;body)
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;values&nbsp;(
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'$form:author',
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'$form:email',
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'${date.year}-${date.month}-${date.day}',
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'$form:text'
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>)</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=responsefields.htm>response:location</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>[$</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b><a href=requesturi.htm>request:uri</a></b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>]
<br>
&nbsp;&nbsp;&nbsp;}{
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;center&gt;Поле&nbsp;автор&nbsp;обязательно&nbsp;для&nbsp;заполнения&lt;/center&gt;
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>&nbsp;&nbsp;&nbsp;}
<br>
}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Посмотрите на код. В первой строке мы говорим, что в этом файле будем хранить пользовательский класс:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@CLASS
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>
<br>
В том случае если в качестве родительского выступает другой пользовательский класс, его необходимо подключить, а также объявить базовым. Получится такая конструкция:
<br>
</i></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
@CLASS
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>имя класса  
<br>
</i></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
@USE
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>файл родительского класса     
<br>

<br>
</i></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@BASE&nbsp;
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><i>имя родительского класса  &nbsp;&nbsp;&nbsp;
<br>
</i>
<br>
Следующей строкой пишем имя нашего класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Необходимо помнить, что Parser чувствителен к регистру букв в именах, поэтому классы </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> и </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> являются разными. При этом имя не обязательно должно совпадать с именем файла, в котором храниться пользовательский класс, более того, может быть набрано русскими буквами. &nbsp;&nbsp;&nbsp;
<br>

<br>
Дальше определяются методы нашего нового класса. Делается это точно так же, как и определение обычных методов, которые мы создавали на предыдущих уроках. 
<br>

<br>
Первый метод </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>load</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> будет конструктором нашего класса. При этом надо иметь в виду, что задача конструктора - создать объект. Кроме этого, он может объявить переменные и присвоить им значения. Эти переменные станут полями объекта пользовательского класса. В нашем случае мы при помощи конструктора <b>sql</b> класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>table</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> создаем нужную таблицу. Обратите внимание, что в методах нового класса мы свободно пользуемся методами системных классов и методом </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>dbconnect</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@load[]
<br>
^MAIN:dbconnect{
<br>
&nbsp;&nbsp;&nbsp;$messages[^table::sql{</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>select&nbsp;author,&nbsp;email,&nbsp;date,&nbsp;body&nbsp;from&nbsp;gbook</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>}]
<br>
}
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Как уже говорилось выше, поскольку мы находимся за пределами класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, для использования методов этого класса перед именем необходимо указать класс, к которому эти методы/поля относятся. Делается это таким образом:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>^имя_класса:метод[параметры]
<br>
$имя_класса:переменная
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
В случае, если мы захотим использовать методы/поля другого пользовательского класса, а не класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, необходимо в начале кода выполнять инструкцию:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@USE
<br>
путь&nbsp;к&nbsp;файлу,&nbsp;описывающему&nbsp;класс
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Она позволяет использовать модуль, определенный в другом файле. О работе Parser с путями к файлам, рассказано в <a href=app1pathclass.htm>приложении 1</a>.
<br>

<br>
Итак, наш новый конструктор будет создавать таблицу с сообщениями, подключаясь к указанной БД. С конструктором разобрались, начинаем описание собственно методов нового класса. Метод </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>show_messages</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> нашего класса выводит на экран сообщения из таблицы </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gb</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, созданной в методе </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>load</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Строки перебираются при помощи метода </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>menu</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>table</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Все знакомо, ничего нового нет и в других методах:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>show_form</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">  - выводит на экран форму для добавления нового сообщения гостевой книги
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>test_and_post_message</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> - проверяет, нажата ли кнопка </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>post</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, заполнено ли поле author и, если все условия выполнены, заносит сообщение в базу данных, используя все тот же метод </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>dbconnect</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, определенный в классе </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>

<br>
На этом создание пользовательского класса, описывающего методы объектов класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, завершено. Его осталось только подключить для использования на нашем сайте. Перед нами стоит задача сообщить Parser, что на некоторой странице мы собираемся использовать свой класс. Для этого в файле </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>index.html</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> каталога </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> в первой строке напишем следующее:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@USE
<br>
/classes/gbook.p
<br>
</b></span></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Теперь на этой странице можно создать объект класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>gbook</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> и использовать затем его методы. Сделаем это в основной информационной части:
<br>

<br>
</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@body_main[]
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Гостевая&nbsp;книга&nbsp;тестового&nbsp;сайта&lt;br&nbsp;/&gt;
<br>
&lt;hr&nbsp;/&gt;
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
$gb[^gbook::load[]]
<br>
^gb.show_messages[]
<br>
^gb.show_form[]
<br>
^gb.test_and_post_message[]
<br>

<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>#&nbsp;и&nbsp;конечно&nbsp;же&nbsp;не&nbsp;забываем&nbsp;про&nbsp;остальные&nbsp;части&nbsp;
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>@greeting[]
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Оставьте&nbsp;свой&nbsp;след:
<br>
</b><span style="font-family:Monospace; font-size:10pt; color:#0000FF"><b>
<br>
@body_additional[]
<br>
</b></span></span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>Нам&nbsp;пишут…
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Здесь мы уже работаем с объектом созданного пользовательского класса, как с любым другим объектом: создаем его при помощи конструктора класса и вызываем методы, определенные в новом классе. Посмотрите, насколько изящным получилось наше решение. Читабельность кода очевидна и, глядя на этот фрагмент, сразу понятно, что он делает. Все, что относится к гостевой книге, находится в отдельном файле, где описано все, что можно с ней сделать. Если нам понадобится новый метод для работы с гостевой книгой, нужно просто дописать его в файл </span><span style="font-family:Monospace; font-size:10pt; color:#000000">gbook.p</span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">. Все очень легко модернизируется, к тому же сразу понятно, где необходимо вносить изменения, если они вдруг понадобились. 
<br>

<br>
В заключение хочется заметить, что изящнее было бы вынести методы вроде </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>dbconnect</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> из класса </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> в отдельный класс. Это позволило бы не перегружать класс </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>MAIN</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">, улучшилась бы читаемость кода, а также легче стало бы ориентироваться в проекте. Там, где эти нужны методы этого класса, его можно было бы подключать с помощью </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>@USE</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">.</span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b>
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
Подведем итоги пятого урока. 
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Что мы сделали:</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> создали свой собственный класс и на основе объекта этого класса создали гостевую книгу на нашем сайте.
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Что узнали:
<br>
</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
<table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><font face="Symbol" size="2" color="#000000">&#183;</font></span></span></td><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">класс </span><span style="font-family:Monospace; font-size:10pt; color:#000000"><b><a href=mainclass.htm>MAIN</a></b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><font face="Symbol" size="2" color="#000000">&#183;</font></span></td><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">создание пользовательского класса
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td width="14"><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"><font face="Symbol" size="2" color="#000000">&#183;</font></span></td><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">как передавать параметры методам 
&nbsp;<br>
</span></td></tr></table><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr valign="top"><td><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"></span></td><td></td></tr></table><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000">
<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Что надо запомнить:</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> класс является «высшей формой» структуризации, поэтому необходимо стремиться к выделению в отдельные классы кубиков, из которых вы будете строить ваши сайты. Это позволяет достичь максимальной понятности логики работы проектов и дает невероятные удобства в дальнейшей работе.
<br>

<br>
</span><span style="font-family:FreeSetC,Arial; font-size:12pt; color:#000000"><b>Что делать дальше:</b></span><span style="font-family:FreeSetC,Arial; font-size:10pt; color:#000000"> на этом создание нашего учебного сайта можно считать завершенным. Конечно, он далек от идеала и использовать его в таком виде не стоит. Для реального использования необходимо выполнить целый ряд доработок: модифицировать календарь в разделе новостей, в гостевой книге организовать проверку введенных данных на корректность и т.д. Но мы и не ставили задачу сделать полнофункциональный проект. Мы просто хотели показать, что работать с Parser совсем не сложно, а производительность от его использования возрастает существенно. Теперь вы сами обладаете всеми необходимыми базовыми знаниями для полноценной работы с Parser, остается только совершенствовать их и приобретать опыт. 
<br>

<br>
Удачи!
<br>
</span></span><br>

<!--#include virtual="/docs/comment.html" -->


<hr size=1>
<table border="0" cellspacing="0" cellpadding="0" width="100%">
<tr valign="top">
<td><font size="1">Copyright &copy; 1997&#150;2011 Art. Lebedev Studio | <a href="http://www.artlebedev.ru/" target="_blank">http://www.artlebedev.ru</a></font></td>
<td align="right"><font size="1">Дата обновления: 04.09.2008</font></td>
</tr>
</table>
</body>
</html>
